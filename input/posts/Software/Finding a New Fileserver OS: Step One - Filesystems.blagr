Title:Finding a New Fileserver OS: Step One - Filesystems
Author:rsaxvc
CreatedDateTime:2008-11-12T01:15:00
ModifiedDateTime:2008-11-12T01:17:26
Tag:Linux
Tag:OpenSolaris
Tag:RAID
Tag:Solaris
Tag:Standard RAID levels
Tag:Storage
Tag:ZFS
---
<div class="asset-header" style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; "><div class="asset-meta">Recently, I started to run out of hard drive space. Previously, I was using this machine as a Linux desktop/fileserver, but as I've become more accustomed to running <a class="zem_slink" href="http://en.wikipedia.org/wiki/Mac_OS_X" title="Mac OS X" rel="wikipedia">OSX</a>/Windows2003/Linux2.6 on my laptop, I've lost the need for a local console.</div></div><div class="asset-content entry-content" style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; "><div class="asset-body"><br />Previous setup:<br />2x250Gig 7200RpM Sata drives in <a class="zem_slink" href="http://en.wikipedia.org/wiki/Standard_RAID_levels" title="Standard RAID levels" rel="wikipedia">Raid-0</a><br />1x80Gig drive for backup<br /><br />New Setup:<br />4x500Gig 7200RpM drives in Raid5/Raid6/<a class="zem_slink" href="http://en.wikipedia.org/wiki/ZFS" title="ZFS" rel="wikipedia">ZFS</a>/BTRFS<br />assuming 20MB/s = 160Mb/s<br />1x80Gig drive for OS<br /><br />Comparisons:<br />FSCK Checking Time<br />Compression<br />OverHead<br />Data Safety<br />Speed ( I want 400Mb/s from the array)<br /><br /><br /><a href="http://en.wikipedia.org/wiki/ZFS">ZFS</a><br />I've used ZFS with <a class="zem_slink" href="http://en.wikipedia.org/wiki/Solaris_%28operating_system%29" title="Solaris (operating system)" rel="wikipedia">Solaris 10</a> before, and I must say I'm impressed. It offers dynamic compression, multi-drive mounts, and redundancy up to a level of your choosing. We used ZFS on the ACM fileserver. It handles 12 drives (18Gig, 15kRpM scsi drives) with double redundancy (3 failures must occur before data loss). The main bottleneck in this system is the 100Meg Sun HappyMeal Ethernet card, which it can effortlessly keep filled with AFS data. Also, the CPUs in this box are 400Mhz each, so I figure 4xP4s will have no trouble at all with fewer drives. What about a filesystem check? ZFS keeps things stable at all times. A full scrub is relative to the amount of data stored, not the size of the disks. Supported <a class="zem_slink" href="http://en.wikipedia.org/wiki/Operating_system" title="Operating system" rel="wikipedia">Operating Systems</a>: OSX Snow Leopard, <a class="zem_slink" href="http://en.wikipedia.org/wiki/FreeBSD" title="FreeBSD" rel="wikipedia">FreeBSD</a>, Solaris, <a class="zem_slink" href="http://en.wikipedia.org/wiki/OpenSolaris" title="OpenSolaris" rel="wikipedia">OpenSolaris</a>, and Linux/FUSE.<br /><br /><a href="http://en.wikipedia.org/wiki/Btrfs">BetterFS</a><br />BetterFS is supposed to replace Ext4 when it is done. It isn't done yet though. When done, it should feature multi-drive mounts (but only Raid0/Raid1 style), CopyOnWrite for everything, ACLs, and online FSCK. However, at time of writing, it isn't done yet. Supported Operating Systems: Linux.<br /><br /><a href="http://en.wikipedia.org/wiki/Standard_RAID_levels#RAID_5">Raid-5</a>&nbsp;with a standard filesystem<br />Raid-5 is a method for adding checksumming to a group of block devices. It presents you with one virtual drive consisting of many hardware drives. However, you lose 1 drive out of n for parity, so your efficiency is (n-1) drives, and there have been some problems with Raid5 scaling to very large numbers of drives. Supported Operating Systems: Linux, FreeBSD, NetBSD, Solaris, OpenSolaris, and Windows Server.<br /><br /><a href="http://en.wikipedia.org/wiki/Standard_RAID_levels#RAID_6">Raid-6</a>&nbsp;with a standard filesystem<br />Raid-6 is much like Raid-5, but you use the equivalent of two drives for parity, so your efficiency is (n-2). This also takes more cpu time to write, the Raid has to be checked in its entirety, not just the space with files on it, and still has scalability problems. Supported Operating Systems: Solaris/OpenSolaris, or any other with a hardware card.<br /><br /><a href="http://www.dragonflybsd.org/hammer/index.shtml">HammerFS</a><br />HammerFS is a relatively recent filesystem for <a class="zem_slink" href="http://en.wikipedia.org/wiki/DragonFly_BSD" title="DragonFly BSD" rel="wikipedia">DragonFlyBSD</a>. It's neat in the way that it supports clustering, data checksums, multidrive mounts, and dynamic rollback/versioning. However, I only have one machine, so its not the best of options. Supported Operating Systems: DragonFlyBSD.<br /><br /><b>Decisions, Decisions</b><br />Factors:<br /><ul><li>I don't want anything that isn't supported by at least two operating systems. So long HammerFS and BetterFS.</li><li>I don't want to be locked to a single model hardware card. So long Raid-6</li><li>I'd like Linux(liveCD rescue) and OSX support (laptop rescue)<br /></li><li>Fast Fast Fast</li></ul>I'm really just left with ZFS. I mean, Raid-5/EXT3 and Raid-5/JFS have worked for me in the past, but I imagine checking a 2TB array will take forever with that setup. I've seen ZFS perform in the past, so it will be the first FS I test. Now the question is: what OS do I run?</div></div> 
