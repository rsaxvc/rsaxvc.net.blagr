Title:Freespace 2 and Prime Factorization
Author:rsaxvc
CreatedDateTime:2010-11-30T20:35:38
ModifiedDateTime:2010-11-30T20:35:38
Tag:Fate of the Galaxy
Tag:FotG
Tag:FreeSpace 2
Tag:Star Wars
---
Some time ago, I wrote a patch for the open-source continuation of the <a class="zem_slink" href="http://en.wikipedia.org/wiki/FreeSpace_2" title="FreeSpace 2" rel="wikipedia">Freespace 2</a> project (<a href="http://scp.indiegames.us/">FS2_open</a>). Previously, each ship could only select between firing one set of primary weapons, or all sets of primary weapons. Firing individual weapons in a set was decided by the ship's data files.<div><br /></div><div><div>However, games with more complex ships needed a different way to control weapon firing sequences. In particular, <a href="http://swc.hard-light.net/">Fate of the Galaxy</a>, a fan-made <a class="zem_slink" href="http://en.wikipedia.org/wiki/Star_Wars" title="Star Wars" rel="wikipedia">StarWars</a> space shooter, needed a way for pilots to pick how many versus how quickly each bank should fire.&nbsp;As situations change, it may become necessary for pilots to reconfigure primary weapons to fire in parallel,&nbsp;for more of a shotgun effect instead of sequentially firing each weapon in the bank, which leads to a much more even power draw.&nbsp;The <a class="zem_slink" href="http://en.wikipedia.org/wiki/X-wing" title="X-wing" rel="wikipedia">X-Wing</a> is a perfect example of this - when attacking faster craft like interceptors, quad lasers are much more useful.&nbsp;But when attacking swarms of small asteroids, waiting for all four lasers to recharge is a detriment.</div><div><br /></div><div><div>Because FS2_open is a game engine instead of a game, the same code needs to control the firing sequence of each ship.&nbsp;But how does a ship decide what firing sequences to expose to the pilot?&nbsp;The simplest answer is factorization.&nbsp;For example, a ship with four primary weapons in a bank may fire arrangements of 1x4, 2x2, or 4x1. A ship with six can fire 1x6, 2x3, 3x2, or 6x1.&nbsp;Over a long enough time period, the power draw should be consistent, so for each arrangement,&nbsp;delay the firing time by the number of shots, and it will average out evenly.</div></div><div><br /></div><div><div>Finally, there is the question of how to factor these numbers in flight.&nbsp;The simplest solution would be a linear search from 1 to int(sqrt(n)). This could be done at mission load time for each model of ship...&nbsp;or it could be done at compile time with a <a class="zem_slink" href="http://en.wikipedia.org/wiki/Lookup_table" title="Lookup table" rel="wikipedia">look-up table</a> and an assumption about the maximum number of firepoints per bank, which is the solution I implemented.</div></div></div>
